<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.104.1"><meta name=viewport content="width=device-width,initial-scale=1"><title>What is Gitleaks and how to use it? &#183; Akash Chandwani</title><meta name=description content><link type=text/css rel=stylesheet href=https://akashchandwani.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://akashchandwani.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://akashchandwani.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://akashchandwani.github.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class=container><div class=sidebar-about><a href=https://akashchandwani.github.io/><h1>Akash Chandwani</h1></a><p class=lead>Software Engineer || @ McKinsey & Company | All views expressed are mine.</p></div><nav><ul class=sidebar-nav><li><a href=https://akashchandwani.github.io/>Home</a></li><li><a href=https://github.com/akashchandwani/>Github</a></li><li><a href=https://www.linkedin.com/in/akashchandwani/>LinkedIn</a></li></ul></nav><p>&copy; 2022. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>What is Gitleaks and how to use it?</h1><time datetime=2022-09-28T23:19:43+0530 class=post-date>Wed, Sep 28, 2022</time><p>Gitleaks is an open source tool used to detect and prevent secrets (passwords / api-keys) checked-in to your git repository. The main advantage of Gitleaks is that it not only scans your latest source code but also the entire git history identifying any secrets committed to your source code in the past as well.</p><blockquote><p>Once your secrets are committed, assume it’s leaked.</p></blockquote><table><thead><tr><th style=text-align:center><img src=kenny-eliason-_Kmtj6UIlGo-unsplash.jpg alt="Across columns"></th></tr></thead><tbody><tr><td style=text-align:center>Photo by <a href="https://unsplash.com/@neonbrand?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Kenny Eliason</a> on <a href="https://unsplash.com/s/photos/hacker-kenny?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></td></tr></tbody></table><blockquote><p>Use gitleaks before a hacker uses it to exploit you…</p><p>— Your friend at open source</p></blockquote><h1 id=how-to-use-gitleaks>How to use Gitleaks?</h1><p>Before you can use Gitleaks, you will need to install it. There are several ways to install it. We will cover the best installation option according to the scenarios discussed below. <a href=https://github.com/zricethezav/gitleaks#getting-started>Here</a> is a list of all available options if you want to visit it now.</p><p>There are several scenarios where you would find Gitleaks useful. I have listed down the most common scenarios below:</p><h2 id=scenario-1>Scenario 1:</h2><p><em><strong>Everything is committed in my git source code repository and I want to find if there are/were any secrets committed.</strong></em></p><p>This is the most common scenario if you want to detect any secrets committed to your git source code repository. For this, you can:</p><ol><li>Install gitleaks on your system.</li><li>Mac users can install gitleaks via homebrew using the command — <code>brew install gitleaks</code>.</li><li>Windows and Linux users can visit the release page of Gitleaks <a href=https://github.com/zricethezav/gitleaks/releases>here</a> and download and install the appropriate version from there.</li><li>Open terminal and go to the source code repository you want to detect secrets from <code>cd &lt;path-to-your-source-code-repository></code></li><li>Run the following command to find if there are secrets committed in your git repository — <code>gitleaks detect</code></li><li>Run the following command to find the details of secrets committed in your git repository — <code>gitleaks detect -v</code></li></ol><p><em>If you have found some secrets in your source code repository and you want to erase them, there are several tools that can help you. BFG repo cleaner is one of them. I will be soon writing a separate blog on how to use this tool…</em></p><h2 id=scenario-2>Scenario 2:</h2><p><em><strong>I want to make sure that I don’t commit any secret in my git source code repository</strong></em></p><p>There is a famous saying — &ldquo;<em>Prevention is better than cure</em>&rdquo;. Similarly it’s better to protect your repository from accidental leaks rather than cleaning it later. For this, you can:</p><ol><li>Install gitleaks on your system. (Refer step 1 in scenario 1)</li><li>Open terminal and go to the source code repository you want to inspect for any secrets. <code>cd &lt;path-to-your-source-code-repository></code></li><li>Run the following command to find any secrets in your code changes — <code>gitleaks protect</code>. (Note: Secrets in untracked files are not detected in this step)</li><li>Run the following command to find the details the secrets in your code changes— <code>gitleaks protect -v</code></li><li>Remove any secrets that were detected in step 3 and step 4.</li><li>Move your code changes to staging area by using the command — <code>git add &lt;files-to-add-to-staging-environment></code>. Use <code>git add .</code> to move all code changes to the staging area.</li><li>Run the following command to find if there are any secrets in the staging area in your git repository — <code>gitleaks protect --staged</code></li><li>Run the following command to find the details if there are secrets in the staging area — <code>gitleaks protect --staged -v</code></li><li>If there were any secrets detected in step 7 and step 8. Remove the secrets and add the changes back to the staging area.</li></ol><h2 id=scenario-3>Scenario 3:</h2><p><em><strong>I want to automate the process of checking secret in my code changes in before I commit it</strong></em></p><p>In this scenario, what we want to automate the process mentioned in scenario 2. As a human we are prone to making mistakes, and sometimes we might forget to check if we are adding secrets in our commits. For this, we can add gitleaks protect &ndash;staged -v command in our pre-commit hook file. Follow the steps:</p><ol><li>Install gitleaks in your system. (Refer step 1 in scenario 1)</li><li>Open terminal and go to the source code repository you want to inspect for any secrets. <code>cd &lt;path-to-your-source-code-repository></code></li><li>Rename the <code>pre-commit.sample</code> file in your <code>.git/hooks</code> folder to pre-commit using the command — <code>mv .git/hooks/pre-commit.sample .git/hooks/pre-commit</code></li><li>Make sure the file has executing permission by running the following command — <code>chmod +x .git/hooks/pre-commit</code></li><li>Open the pre-commit file in your preferred editor and add the following line at the end of the file — <code>exec gitleaks protect --staged -v</code></li></ol><p>Instead of step 5, you can also choose to use the pre-commit script provided by the gitleaks community. For this, replace the content in your pre-commit file with the content with this.</p><h2 id=scenario-4>Scenario 4:</h2><p><em><strong>I want to make sure that my team does not check-in any secret in the source code repository</strong></em></p><p>In the previous scenario we have automated the process of detecting secrets before it’s checked-in in your local repository. But in a more real scenario, a team works on the same source code repository and managing git-hooks in each of the individual’s machine could be cumbersome and manual process. For this, we can use a pre-commit tool for managing this configuration across developer’s machine. The steps for it are:</p><ol><li>Install pre-commit using one of the following ways mentioned <a href=https://pre-commit.com/#installation>here</a>.</li><li>Open terminal and go to the source code repository you want to inspect for any secrets. <code>cd &lt;path-to-your-source-code-repository></code></li><li>Create a <code>.pre-commit-config.yaml .</code> Mac and linux users can use touch command for it — <code>touch .pre-commit-config.yaml</code></li><li>Paste the following content into the file<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.pre-commit-config.yaml data-lang=.pre-commit-config.yaml><span style=display:flex><span><span style=color:#f92672>repos</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://github.com/zricethezav/gitleaks</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>v8.11.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hooks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>gitleaks</span>
</span></span></code></pre></div></li><li>Update the version of gitleaks in the file using the following command — <code>pre-commit autoupdate</code></li><li>Install the pre-commit in your pre-commit hooks using the following command — <code>pre-commit install</code></li><li>Now when ever you commit, the <code>pre-commit</code> hook installed in your repository will check if any secrets are present in your changes. You will just need to make sure every of developer installs pre-commit using the step 1 and installs pre-commit using the command in step 7.</li></ol><h2 id=scenario-5>Scenario 5:</h2><p><em><strong>What if my team mate does not update his/her pre-commit hook file and checks-in a secret</strong></em></p><p>Well, mistakes can happen from anyone. Also, you can’t make sure if every developer in your team has updated his/her pre-commit config. They can be ignorant and not follow the steps. The best way to make sure that secrets are not checked-in is at the entry point of your remote source code repository i.e., to scan the project once anyone pushes the code to the source code repository. This can be achieved by running <code>gitleaks detect</code> command in your remote source code repository when ever a code is checked into the repository. This can be configured via various CI tools.</p><p>If your remote source code via the CI process, you use, you can use gitleaks detect command in <code>Github Actions</code> to detect any leaks from your repository.</p><h2 id=scenario-6>Scenario 6:</h2><p><em><strong>I don’t use git, can I still use gitleaks to detect secrets in my source code?</strong></em></p><p>Yes absolutely. You can use Gitleaks with any source code repository even if it’s not version controlled by git. To use gitleaks with non-git repository, use gitleaks detect with <code>--no-git</code> option.</p><ol><li>Install Gitleaks on your system (Refer step 1 in scenario 1)</li><li>Run gitleaks detect command with <code>--no-git</code> option — <code>gitleaks detect --no-git</code></li></ol><h1 id=conclusion>Conclusion:</h1><p>In this blog we have seen various scenarios on how to we can use gitleaks to detect and protect our source code from accidental leaks. In my next blog I will write on how to remove secrets from your source code repository if you have detected it.</p></div></main></body></html>